<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Интерактивная игра "TECNO AI EXPERT"</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, rgba(106, 17, 203, 0.8) 0%, rgba(37, 117, 252, 0.8) 100%), url('background.jpg') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: white;
        }

        /* Стиль для скрытия основного контента при открытом модальном окне */
        body.modal-open {
            overflow: hidden;
        }

        .main-content {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        body.modal-open .main-content {
            display: none;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            width: 100%;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .instructions {
            max-width: 600px;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            margin: 0 auto 20px;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 800px;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
            width: 100%;
        }

        .card {
            aspect-ratio: 1 / 1;
            perspective: 1000px;
            cursor: pointer;
        }

        .card.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-weight: bold;
            padding: 10px;
        }

        .card-front {
            background: linear-gradient(45deg, #ff9a9e 0%, #fad0c4 100%);
            color: #333;
            font-size: 3rem;
        }

        .card-front img {
            width: 70%;
            height: auto;
            object-fit: contain;
        }

        .card-back {
            background: linear-gradient(45deg, #a1c4fd 0%, #c2e9fb 100%);
            color: #333;
            transform: rotateY(180deg);
            font-size: 1.2rem;
        }

        .timer-container {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            width: 100%;
            max-width: 300px;
            margin-bottom: 15px;
        }

        .timer {
            font-size: 2rem;
            margin: 10px 0;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            justify-content: center;
        }

        button {
            background: linear-gradient(45deg, #ff9a9e 0%, #fad0c4 100%);
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            color: #333;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(1px);
        }

        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .round-info {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 15px;
            width: 100%;
            max-width: 300px;
        }

        .results-table {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            width: 100%;
            max-width: 600px;
            margin-top: 20px;
            display: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        th {
            background-color: rgba(255, 255, 255, 0.2);
        }

        footer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Модальные окна */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .modal-content {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal h2 {
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        input, textarea {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: none;
            background-color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
        }

        textarea {
            height: 80px;
            resize: vertical;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 10px 0;
        }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        .success-message {
            display: none;
            text-align: center;
            margin: 10px 0;
            color: #90EE90;
            font-weight: bold;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .cards-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .timer {
                font-size: 1.8rem;
            }
            
            body {
                background: linear-gradient(135deg, rgba(106, 17, 203, 0.8) 0%, rgba(37, 117, 252, 0.8) 100%), url('background-mobile.jpg') no-repeat center center fixed;
                background-size: cover;
            }
            
            .modal {
                align-items: flex-start;
                padding-top: 40px;
                padding-bottom: 40px;
            }
            
            .modal-content {
                max-height: 85vh;
            }
        }

        @media (max-width: 480px) {
            .cards-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .timer {
                font-size: 1.5rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                max-width: 200px;
            }
            
            body {
                background: linear-gradient(135deg, rgba(106, 17, 203, 0.8) 0%, rgba(37, 117, 252, 0.8) 100%), url('background-mobile.jpg') no-repeat center center fixed;
                background-size: cover;
            }
            
            .modal {
                align-items: flex-start;
                padding-top: 20px;
                padding-bottom: 20px;
            }
            
            .modal-content {
                max-height: 80vh;
            }
        }
    </style>
</head>
<body>
    <!-- Модальное окно для ввода данных -->
    <div id="namesModal" class="modal">
        <div class="modal-content">
            <h2>Введите данные участников</h2>
            <div class="form-group">
                <label for="participantName">Имя и фамилия участника:</label>
                <input type="text" id="participantName" placeholder="Введите имя и фамилию участника">
            </div>
            <div class="form-group">
                <label for="hostName">Имя и фамилия ведущего:</label>
                <input type="text" id="hostName" placeholder="Введите имя и фамилию ведущего">
            </div>
            <div class="form-group">
                <label for="network">Сеть:</label>
                <input type="text" id="network" placeholder="Введите название сети">
            </div>
            <div class="form-group">
                <label for="city">Город:</label>
                <input type="text" id="city" placeholder="Введите город">
            </div>
            <div class="form-group">
                <label for="storeAddress">Адрес магазина:</label>
                <input type="text" id="storeAddress" placeholder="Введите адрес магазина">
            </div>
            <div class="form-group">
                <label for="storeCode">Код точки:</label>
                <input type="text" id="storeCode" placeholder="Введите код точки">
            </div>
            <div class="modal-buttons">
                <button id="startGameBtn">Начать игру</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно для пропуска карточки -->
    <div id="skipModal" class="modal">
        <div class="modal-content">
            <h2>Почему была пропущена карточка?</h2>
            <div class="form-group">
                <label for="skipReason">Комментарий:</label>
                <textarea id="skipReason" placeholder="Опишите причину пропуска карточки"></textarea>
            </div>
            <div class="modal-buttons">
                <button id="submitSkipBtn">Отправить</button>
                <button id="cancelSkipBtn">Отмена</button>
            </div>
        </div>
    </div>

    <!-- Скрытая форма для отправки данных в Google Таблицы -->
    <form id="submit-to-google-sheet" style="display: none;">
        <input name="Host" type="text" id="form-host">
        <input name="Participant" type="text" id="form-participant">
        <input name="Card" type="text" id="form-card">
        <input name="Time" type="text" id="form-time">
        <input name="Status" type="text" id="form-status">
        <input name="Comment" type="text" id="form-comment">
        <input name="Round" type="text" id="form-round">
        <input name="Network" type="text" id="form-network">
        <input name="City" type="text" id="form-city">
        <input name="StoreAddress" type="text" id="form-store-address">
        <input name="StoreCode" type="text" id="form-store-code">
        <button type="submit" id="form-submit-btn">Send</button>
    </form>

    <!-- Основной контент игры -->
    <div class="main-content">
        <header>
            <h1>TECNO AI EXPERT</h1>
            <div class="instructions">
                <p>Кликните на карточку, чтобы перевернуть её и увидеть текст. Карточки перемешиваются при каждом раунде.</p>
            </div>
        </header>

        <div class="game-container">
            <div class="round-info" id="roundInfo">
                Раунд: <span id="currentRound">1</span> из 6
            </div>

            <div class="cards-grid" id="cardsGrid">
                <!-- Карточки будут сгенерированы с помощью JavaScript -->
            </div>

            <div class="timer-container">
                <h2>Секундомер</h2>
                <div class="timer" id="timer">00:00.00</div>
                <div class="controls">
                    <button id="startBtn" disabled>Старт</button>
                    <button id="stopBtn" disabled>Стоп</button>
                    <button id="resetBtn" disabled>Сброс</button>
                </div>
            </div>

            <div class="controls">
                <button id="doneBtn" disabled>Сделано</button>
                <button id="skipBtn" disabled>Пропущено</button>
            </div>

            <div class="loading" id="loadingIndicator">
                <div class="loading-spinner"></div>
                <p>Отправка данных...</p>
            </div>

            <div class="success-message" id="successMessage">
                <p>✓ Данные успешно отправлены!</p>
            </div>

            <div class="results-table" id="resultsTable">
                <h2>Результаты игры</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Раунд</th>
                            <th>Карточка</th>
                            <th>Время</th>
                            <th>Статус</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody">
                        <!-- Результаты будут добавляться с помощью JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <footer>
            <p>Интерактивная игра "TECNO AI EXPERT" &copy; 2023</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Обновленные тексты для обратной стороны карточек
            const allCardTexts = [
                "Ассистент Ella (Где найти помощника)",
                "Ассистент Ella (Умный поиск)",
                "Помощник по работе с документами",
                "Редактор AI",
                "Работа с документами (Картинка в документ)",
                "Работа с документами (Расшифровка записей диктофона)",
                "Круг для поиска",
                "Интеграция с сервисами Яндекс",
                "Решение математических задач",
                "Студия AI (Удаление объекта с фотографии)",
                "Студия AI (Расширение границ кадра)",
                "Студия AI (AI Доска для рисования)",
                "Студия AI (AI Генератор обоев)",
                "Студия AI (Улучшение групповых портретов)",
                "Умный переводчик (Перевод разговора)",
                "Умный переводчик (Синхронный перевод)",
                "Умный переводчик (Перевод изображений)",
                "Телефонный помощник (Сводка и расшифровка звонков)",
                "Телефонный помощник (Автоответчик AI)",
                "Телефонный помощник (Перевод звонков в реальном времени)",
                "Телефонный помощник (ИИ Шумоподавление)"
            ];

            // Элементы DOM
            const cardsGrid = document.getElementById('cardsGrid');
            const timerDisplay = document.getElementById('timer');
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            const resetBtn = document.getElementById('resetBtn');
            const doneBtn = document.getElementById('doneBtn');
            const skipBtn = document.getElementById('skipBtn');
            const namesModal = document.getElementById('namesModal');
            const skipModal = document.getElementById('skipModal');
            const startGameBtn = document.getElementById('startGameBtn');
            const submitSkipBtn = document.getElementById('submitSkipBtn');
            const cancelSkipBtn = document.getElementById('cancelSkipBtn');
            const currentRoundDisplay = document.getElementById('currentRound');
            const resultsTable = document.getElementById('resultsTable');
            const resultsBody = document.getElementById('resultsBody');
            const roundInfo = document.getElementById('roundInfo');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const successMessage = document.getElementById('successMessage');
            const body = document.body;
            const mainContent = document.querySelector('.main-content');
            
            // Элементы формы для Google Sheets
            const googleForm = document.getElementById('submit-to-google-sheet');
            const formHost = document.getElementById('form-host');
            const formParticipant = document.getElementById('form-participant');
            const formCard = document.getElementById('form-card');
            const formTime = document.getElementById('form-time');
            const formStatus = document.getElementById('form-status');
            const formComment = document.getElementById('form-comment');
            const formRound = document.getElementById('form-round');
            const formNetwork = document.getElementById('form-network');
            const formCity = document.getElementById('form-city');
            const formStoreAddress = document.getElementById('form-store-address');
            const formStoreCode = document.getElementById('form-store-code');

            // Переменные игры
            let timerInterval;
            let startTime;
            let elapsedTime = 0;
            let isRunning = false;
            let currentRound = 1;
            let totalRounds = 6;
            let gameStarted = false;
            let participantName = '';
            let hostName = '';
            let network = '';
            let city = '';
            let storeAddress = '';
            let storeCode = '';
            let currentCardText = '';
            let gameResults = [];
            let usedCardTexts = [];
            let cardFlippedInRound = false;
            let gameStartTime = null;

            // URL скрипта Google Apps - ЗАМЕНИТЕ НА СВОЙ URL
            const scriptURL = 'https://script.google.com/macros/s/AKfycbzY2kE3ItUU8aqHTG_gG-gtqWKclMioOW8aBZySytJykXwsP7sRGqxQHNDVR55qSyKX/exec';

            // Функция для показа модального окна ввода данных
            function showNamesModal() {
                namesModal.style.display = 'flex';
                body.classList.add('modal-open');
            }

            // Функция для скрытия модального окна ввода данных
            function hideNamesModal() {
                namesModal.style.display = 'none';
                body.classList.remove('modal-open');
            }

            // Функция для показа модального окна пропуска карточки
            function showSkipModal() {
                skipModal.style.display = 'flex';
            }

            // Функция для скрытия модального окна пропуска карточки
            function hideSkipModal() {
                skipModal.style.display = 'none';
            }

            // Показать модальное окно с вводом имен при загрузке
            showNamesModal();

            // Функция для перемешивания массива
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // Функция для получения доступных текстов карточек
            function getAvailableCardTexts() {
                return allCardTexts.filter(text => !usedCardTexts.includes(text));
            }

            // Создание и отрисовка карточек
            function createCards() {
                cardsGrid.innerHTML = '';
                const availableTexts = getAvailableCardTexts();
                const textsToUse = availableTexts.length >= 12 
                    ? shuffleArray([...availableTexts]).slice(0, 12)
                    : shuffleArray([...availableTexts]);
                
                textsToUse.forEach((text) => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.dataset.text = text;
                    card.innerHTML = `
                        <div class="card-inner">
                            <div class="card-front">
                                <img src="card-logo.png" alt="TECNO AI">
                            </div>
                            <div class="card-back">
                                <span>${text}</span>
                            </div>
                        </div>
                    `;
                    
                    card.addEventListener('click', function() {
                        if (!this.classList.contains('flipped') && !cardFlippedInRound) {
                            this.classList.add('flipped');
                            currentCardText = this.dataset.text;
                            cardFlippedInRound = true;
                            
                            // Разблокируем кнопки секундомера и действия
                            startBtn.disabled = false;
                            resetBtn.disabled = false;
                            skipBtn.disabled = false;
                            
                            const allCards = document.querySelectorAll('.card');
                            allCards.forEach(c => {
                                if (!c.classList.contains('flipped')) {
                                    c.classList.add('disabled');
                                }
                            });
                        }
                    });
                    
                    cardsGrid.appendChild(card);
                });
            }

            // Функции для секундомера
            function formatTime(ms) {
                const minutes = Math.floor(ms / 60000);
                const seconds = Math.floor((ms % 60000) / 1000);
                const hundredths = Math.floor((ms % 1000) / 10);
                
                return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${hundredths.toString().padStart(2, '0')}`;
            }

            function updateTimer() {
                const currentTime = Date.now();
                elapsedTime = currentTime - startTime;
                timerDisplay.textContent = formatTime(elapsedTime);
            }

            function startTimer() {
                if (!isRunning) {
                    isRunning = true;
                    startTime = Date.now() - elapsedTime;
                    timerInterval = setInterval(updateTimer, 10);
                    startBtn.disabled = true;
                    stopBtn.disabled = false;
                    doneBtn.disabled = false;
                }
            }

            function stopTimer() {
                if (isRunning) {
                    isRunning = false;
                    clearInterval(timerInterval);
                    startBtn.disabled = false;
                    stopBtn.disabled = true;
                }
            }

            function resetTimer() {
                stopTimer();
                elapsedTime = 0;
                timerDisplay.textContent = '00:00.00';
                startBtn.disabled = true;
                stopBtn.disabled = true;
                doneBtn.disabled = true;
                skipBtn.disabled = true;
                resetBtn.disabled = true;
            }

            // Функция для создания и скачивания файла с результатами
            function saveGameResultsToFile() {
                if (gameResults.length === 0) return;
                
                // Создаем CSV содержимое
                let csvContent = "Дата проведения игры,Время проведения раунда,Раунд,Участник,Ведущий,Карточка,Время,Статус,Комментарий,Сеть,Город,Адрес магазина,Код точки\n";
                
                gameResults.forEach(result => {
                    const row = [
                        result.gameDate,
                        result.roundTime,
                        result.round,
                        `"${result.participant}"`,
                        `"${result.host}"`,
                        `"${result.card}"`,
                        `"${result.time}"`,
                        `"${result.status}"`,
                        `"${result.comment}"`,
                        `"${result.network}"`,
                        `"${result.city}"`,
                        `"${result.storeAddress}"`,
                        `"${result.storeCode}"`
                    ].join(',');
                    
                    csvContent += row + '\n';
                });
                
                // Создаем Blob и ссылку для скачивания
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                
                // Формируем имя файла с датой, сетью и именем участника
                const firstResult = gameResults[0];
                const filename = `TECNO_AI_EXPERT_${firstResult.gameDate}_${firstResult.network}_${firstResult.participant}.csv`;
                
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            // Функция для отправки данных в Google Таблицы
            function sendToGoogleSheets(result) {
                // Заполняем скрытую форму данными
                formHost.value = result.host;
                formParticipant.value = result.participant;
                formCard.value = result.card;
                formTime.value = result.time;
                formStatus.value = result.status;
                formComment.value = result.comment;
                formRound.value = result.round;
                formNetwork.value = result.network;
                formCity.value = result.city;
                formStoreAddress.value = result.storeAddress;
                formStoreCode.value = result.storeCode;
                
                // Показываем индикатор загрузки
                loadingIndicator.style.display = 'block';
                
                // Отправляем форму - игнорируем ошибки CORS
                fetch(scriptURL, { 
                    method: 'POST', 
                    body: new FormData(googleForm),
                    mode: 'no-cors'
                })
                .then(() => {
                    // При использовании no-cors мы не получим ответ, но запрос будет отправлен
                    console.log('Данные отправлены (no-cors режим)');
                    loadingIndicator.style.display = 'none';
                    successMessage.style.display = 'block';
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                })
                .catch(error => {
                    // Игнорируем ошибки, так как данные скорее всего отправлены
                    console.log('Запрос выполнен (ошибка CORS проигнорирована)');
                    loadingIndicator.style.display = 'none';
                    successMessage.style.display = 'block';
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                });
            }

            // Функция для завершения раунда
            function completeRound(status, comment = '') {
                if (status === 'Сделано' && elapsedTime === 0) {
                    alert('Пожалуйста, запустите секундомер перед завершением раунда.');
                    return;
                }
                
                const now = new Date();
                const gameDate = now.toISOString().split('T')[0]; // Дата в формате YYYY-MM-DD
                const roundTime = now.toTimeString().split(' ')[0]; // Время в формате HH:MM:SS
                
                const result = {
                    round: currentRound,
                    participant: participantName,
                    host: hostName,
                    card: currentCardText,
                    time: formatTime(elapsedTime),
                    status: status,
                    comment: comment,
                    network: network,
                    city: city,
                    storeAddress: storeAddress,
                    storeCode: storeCode,
                    gameDate: gameDate,
                    roundTime: roundTime
                };
                
                gameResults.push(result);
                
                if (currentCardText && !usedCardTexts.includes(currentCardText)) {
                    usedCardTexts.push(currentCardText);
                }
                
                addResultToTable(result);
                sendToGoogleSheets(result);
                
                resetTimer();
                cardFlippedInRound = false;
                
                if (currentRound < totalRounds) {
                    currentRound++;
                    currentRoundDisplay.textContent = currentRound;
                    createCards();
                } else {
                    endGame();
                }
                
                currentCardText = '';
            }

            // Функция для добавления результата в таблицу
            function addResultToTable(result) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${result.round}</td>
                    <td>${result.card}</td>
                    <td>${result.time}</td>
                    <td>${result.status}</td>
                `;
                resultsBody.appendChild(row);
            }

            // Функция для завершения игры
            function endGame() {
                resultsTable.style.display = 'block';
                doneBtn.disabled = true;
                skipBtn.disabled = true;
                startBtn.disabled = true;
                stopBtn.disabled = true;
                resetBtn.disabled = true;
                currentRoundDisplay.textContent = totalRounds;
                
                // Сохраняем результаты в файл
                saveGameResultsToFile();
            }

            // Функция для автоматической прокрутки к активному полю ввода
            function setupInputScrolling() {
                const inputs = namesModal.querySelectorAll('input');
                inputs.forEach(input => {
                    input.addEventListener('focus', function() {
                        // Плавно прокручиваем к активному полю ввода
                        this.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    });
                });
            }

            // Обработчики событий
            startBtn.addEventListener('click', startTimer);
            stopBtn.addEventListener('click', stopTimer);
            resetBtn.addEventListener('click', resetTimer);

            doneBtn.addEventListener('click', function() {
                if (currentCardText) {
                    completeRound('Сделано');
                } else {
                    alert('Пожалуйста, переверните карточку перед завершением раунда.');
                }
            });

            skipBtn.addEventListener('click', function() {
                if (currentCardText) {
                    showSkipModal();
                } else {
                    alert('Пожалуйста, переверните карточку перед пропуском.');
                }
            });

            startGameBtn.addEventListener('click', function() {
                participantName = document.getElementById('participantName').value.trim();
                hostName = document.getElementById('hostName').value.trim();
                network = document.getElementById('network').value.trim();
                city = document.getElementById('city').value.trim();
                storeAddress = document.getElementById('storeAddress').value.trim();
                storeCode = document.getElementById('storeCode').value.trim();
                
                if (participantName && hostName && network && city && storeAddress && storeCode) {
                    hideNamesModal();
                    gameStarted = true;
                    gameStartTime = new Date();
                    roundInfo.style.display = 'block';
                    createCards();
                } else {
                    alert('Пожалуйста, заполните все поля.');
                }
            });

            submitSkipBtn.addEventListener('click', function() {
                const skipReason = document.getElementById('skipReason').value.trim();
                if (skipReason) {
                    completeRound('Пропущено', skipReason);
                    hideSkipModal();
                    document.getElementById('skipReason').value = '';
                } else {
                    alert('Пожалуйста, укажите причину пропуска.');
                }
            });

            cancelSkipBtn.addEventListener('click', function() {
                hideSkipModal();
                document.getElementById('skipReason').value = '';
            });

            // Настройка прокрутки для полей ввода
            setupInputScrolling();

            // Инициализация игры
            resetTimer();
        });
    </script>
</body>
</html>