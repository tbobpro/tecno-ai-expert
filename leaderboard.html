<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Таблица лидеров - TECNO AI EXPERT</title>
    <link rel="icon" href="aitecnoicon.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, rgba(106, 17, 203, 0.8) 0%, rgba(37, 117, 252, 0.8) 100%), url('background.png') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: white;
        }

        /* Фон для мобильных устройств */
        @media (max-width: 768px) {
            body {
                background: linear-gradient(135deg, rgba(106, 17, 203, 0.8) 0%, rgba(37, 117, 252, 0.8) 100%), url('background-mobile.jpg') no-repeat center center fixed;
                background-size: cover;
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
        }

        .container {
            width: 100%;
            max-width: 1200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        /* Адаптивность контейнера */
        @media (max-width: 768px) {
            .container {
                padding: 18px;
                border-radius: 12px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
                border-radius: 10px;
            }
        }

        header {
            text-align: center;
            margin-bottom: 25px;
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        /* Адаптивность заголовков */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .subtitle {
                font-size: 0.95rem;
                margin-bottom: 15px;
            }
        }

        @media (max-width: 360px) {
            h1 {
                font-size: 1.6rem;
            }
            
            .subtitle {
                font-size: 0.9rem;
            }
        }

        .leaderboard-type-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .type-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 1rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 180px;
        }

        .type-btn.active {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border-color: rgba(255, 255, 255, 0.9);
        }

        .type-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .type-btn.active:hover {
            background: rgba(255, 255, 255, 0.9);
        }

        /* Адаптивность кнопок выбора типа */
        @media (max-width: 768px) {
            .leaderboard-type-selector {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .type-btn {
                width: 100%;
                max-width: 300px;
                padding: 10px 15px;
            }
        }

        @media (max-width: 480px) {
            .type-btn {
                min-width: auto;
                padding: 10px 12px;
                font-size: 0.95rem;
            }
        }

        .filters {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-select {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 1rem;
            color: #333;
            min-width: 140px;
            flex: 1;
            max-width: 200px;
        }

        /* Адаптивность фильтров */
        @media (max-width: 768px) {
            .filters {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .filter-select {
                width: 100%;
                max-width: 300px;
            }
        }

        @media (max-width: 480px) {
            .filter-select {
                padding: 8px 12px;
                font-size: 0.95rem;
                min-width: 120px;
            }
        }

        .category-selector {
            display: none;
            justify-content: center;
            margin-bottom: 20px;
        }

        .category-select {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 1rem;
            color: #333;
            min-width: 300px;
            text-align: center;
        }

        /* Адаптивность выбора категории */
        @media (max-width: 768px) {
            .category-selector {
                width: 100%;
            }
            
            .category-select {
                width: 100%;
                max-width: 300px;
            }
        }

        @media (max-width: 480px) {
            .category-select {
                min-width: auto;
                width: 100%;
                padding: 8px 12px;
                font-size: 0.95rem;
            }
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            -webkit-overflow-scrolling: touch; /* Плавная прокрутка на iOS */
        }

        /* Улучшение отображения скролла на мобильных */
        @media (max-width: 768px) {
            .table-container {
                margin-left: -5px;
                margin-right: -5px;
                width: calc(100% + 10px);
                border-radius: 8px;
            }
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        /* Адаптивность таблицы */
        @media (max-width: 768px) {
            .leaderboard-table {
                min-width: 550px;
                font-size: 0.95rem;
            }
        }

        @media (max-width: 480px) {
            .leaderboard-table {
                min-width: 500px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 360px) {
            .leaderboard-table {
                min-width: 450px;
            }
        }

        th, td {
            padding: 14px 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            background: rgba(255, 255, 255, 0.15);
            font-weight: bold;
            font-size: 1rem;
            position: sticky;
            top: 0;
        }

        /* Адаптивность ячеек таблицы */
        @media (max-width: 768px) {
            th, td {
                padding: 12px 10px;
                font-size: 0.95rem;
            }
        }

        @media (max-width: 480px) {
            th, td {
                padding: 10px 8px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 360px) {
            th, td {
                padding: 8px 6px;
                font-size: 0.85rem;
            }
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .rank {
            font-weight: bold;
            font-size: 1.1rem;
            text-align: center;
            width: 60px;
        }

        .rank-1 { color: #FFD700; }
        .rank-2 { color: #C0C0C0; }
        .rank-3 { color: #CD7F32; }

        /* Адаптивность колонки с рангом */
        @media (max-width: 480px) {
            .rank {
                font-size: 1rem;
                width: 50px;
            }
        }

        @media (max-width: 360px) {
            .rank {
                font-size: 0.95rem;
                width: 45px;
            }
        }

        .participant-name {
            font-weight: bold;
            font-size: 1.05rem;
        }

        /* Адаптивность имени участника */
        @media (max-width: 480px) {
            .participant-name {
                font-size: 1rem;
            }
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
        }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            opacity: 0.8;
        }

        /* Адаптивность состояний загрузки и отсутствия данных */
        @media (max-width: 768px) {
            .loading, .no-data {
                padding: 30px;
                font-size: 1.1rem;
            }
            
            .loading-spinner {
                width: 35px;
                height: 35px;
            }
        }

        @media (max-width: 480px) {
            .loading, .no-data {
                padding: 25px;
                font-size: 1rem;
            }
            
            .loading-spinner {
                width: 30px;
                height: 30px;
            }
        }

        .back-btn {
            background: linear-gradient(45deg, #ff9a9e 0%, #fad0c4 100%);
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            color: #333;
            margin-top: 25px;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            width: 100%;
            max-width: 250px;
        }

        .back-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .back-btn-container {
            display: flex;
            justify-content: center;
            width: 100%;
        }

        /* Адаптивность кнопки возврата */
        @media (max-width: 768px) {
            .back-btn {
                padding: 10px 20px;
                font-size: 0.95rem;
                margin-top: 20px;
            }
        }

        @media (max-width: 480px) {
            .back-btn {
                padding: 10px 15px;
                font-size: 0.9rem;
                max-width: 220px;
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Портретная ориентация на мобильных */
        @media (max-width: 768px) and (orientation: portrait) {
            .table-container {
                margin-left: -10px;
                margin-right: -10px;
                width: calc(100% + 20px);
            }
        }

        /* Ландшафтная ориентация на мобильных */
        @media (max-width: 768px) and (orientation: landscape) {
            .container {
                padding: 15px;
            }
            
            .leaderboard-type-selector {
                flex-direction: row;
                gap: 10px;
            }
            
            .type-btn {
                min-width: 150px;
            }
        }

        .refresh-btn {
    background: linear-gradient(45deg, #4CAF50 0%, #45a049 100%);
    border: none;
    padding: 8px 15px;
    border-radius: 25px;
    font-size: 0.9rem;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    margin-top: 10px;
}

.refresh-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

.refresh-btn:active {
    transform: translateY(0);
}

/* Адаптивность для кнопки обновления */
@media (max-width: 768px) {
    .refresh-btn {
        padding: 6px 12px;
        font-size: 0.85rem;
    }
}

@media (max-width: 480px) {
    .refresh-btn {
        padding: 5px 10px;
        font-size: 0.8rem;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-trophy"></i> Таблица лидеров</h1>
            <div class="subtitle">Лучшие результаты участников по категориям заданий</div>
        </header>

        <div class="leaderboard-type-selector">
            <button class="type-btn active" data-type="overall">Общий зачет (Топ-15)</button>
            <button class="type-btn" data-type="category">Топ по категориям</button>
        </div>

        <div class="filters">
            <select id="networkFilter" class="filter-select">
                <option value="">Все сети</option>
            </select>
            <select id="cityFilter" class="filter-select">
                <option value="">Все города</option>
            </select>
        </div>

        <div class="category-selector" id="categorySelector">
            <select id="categoryFilter" class="category-select">
                <option value="">Выберите категорию</option>
                <option value="Ассистент Ella (Где найти помощника)">Ассистент Ella (Где найти помощника)</option>
                <option value="Ассистент Ella (Умный поиск)">Ассистент Ella (Умный поиск)</option>
                <option value="Помощник по работе с документами">Помощник по работе с документами</option>
                <option value="Редактор AI">Редактор AI</option>
                <option value="Работа с документами (Картинка в документ)">Работа с документами (Картинка в документ)</option>
                <option value="Работа с документами (Расшифровка записей диктофона)">Работа с документами (Расшифровка записей диктофона)</option>
                <option value="Круг для поиска">Круг для поиска</option>
                <option value="Интеграция с сервисами Яндекс">Интеграция с сервисами Яндекс</option>
                <option value="Решение математических задач">Решение математических задач</option>
                <option value="Студия AI (Удаление объекта с фотографии)">Студия AI (Удаление объекта с фотографии)</option>
                <option value="Студия AI (Расширение границ кадра)">Студия AI (Расширение границ кадра)</option>
                <option value="Студия AI (AI Доска для рисования)">Студия AI (AI Доска для рисования)</option>
                <option value="Студия AI (AI Генератор обоев)">Студия AI (AI Генератор обоев)</option>
                <option value="Студия AI (Улучшение групповых портретов)">Студия AI (Улучшение групповых портретов)</option>
                <option value="Умный переводчик (Перевод разговора)">Умный переводчик (Перевод разговора)</option>
                <option value="Умный переводчик (Синхронный перевод)">Умный переводчик (Синхронный перевод)</option>
                <option value="Умный переводчик (Перевод изображений)">Умный переводчик (Перевод изображений)</option>
                <option value="Телефонный помощник (Сводка и расшифровка звонков)">Телефонный помощник (Сводка и расшифровка звонков)</option>
                <option value="Телефонный помощник (Автоответчик AI)">Телефонный помощник (Автоответчик AI)</option>
                <option value="Телефонный помощник (Перевод звонков в реальном времени)">Телефонный помощник (Перевод звонков в реальном времени)</option>
                <option value="Телефонный помощник (ИИ Шумоподавление)">Телефонный помощник (ИИ Шумоподавление)</option>
            </select>
        </div>

        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <p>Загрузка данных...</p>
        </div>

        <div id="noData" class="no-data" style="display: none;">
            <p>Нет данных для отображения</p>
        </div>

        <div class="table-container">
            <table class="leaderboard-table" id="leaderboardTable" style="display: none;">
                <thead>
                    <tr id="tableHeader">
                        <!-- Заголовки будут заполнены через JavaScript -->
                    </tr>
                </thead>
                <tbody id="leaderboardBody">
                    <!-- Данные будут заполнены через JavaScript -->
                </tbody>
            </table>
        </div>

        <div class="back-btn-container">
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> Вернуться к игре
            </a>
        </div>
    </div>

    <script>
    // URL скрипта Google Apps
    const scriptURL = 'https://script.google.com/macros/s/AKfycbx2Lru53tCgMMZkAokfyoeoOc8qRTVQuMKX09fmdGWIOPy3udHral5iH0H0k6E77UAK/exec';

    // Текущий тип лидерборда
    let currentLeaderboardType = 'overall';
    let currentData = []; // Сохраняем загруженные данные
    let cachedOverallData = null; // Кэш для общего зачета
    let isInitialLoad = true; // Флаг первой загрузки

    // Функция для отрисовки общего лидерборда
    function renderOverallLeaderboard(data) {
        const table = document.getElementById('leaderboardTable');
        const tbody = document.getElementById('leaderboardBody');
        const tableHeader = document.getElementById('tableHeader');
        const loading = document.getElementById('loading');
        const noData = document.getElementById('noData');
        
        if (data && data.length > 0) {
            // Устанавливаем заголовки для общего зачета
            tableHeader.innerHTML = `
                <th class="rank">Место</th>
                <th>Участник</th>
                <th>Должность</th>
                <th>Город</th>
                <th>Сеть</th>
                <th>Общее время</th>
            `;
            
            // Заполняем таблицу
            tbody.innerHTML = '';
            data.forEach((participant, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="rank rank-${index + 1}">${index + 1}</td>
                    <td class="participant-name">${participant.participant}</td>
                    <td>${participant.participantRole}</td>
                    <td>${participant.city}</td>
                    <td>${participant.network}</td>
                    <td>${participant.totalTime}</td>
                `;
                tbody.appendChild(row);
            });
            
            loading.style.display = 'none';
            table.style.display = 'table';
            noData.style.display = 'none';
        } else {
            loading.style.display = 'none';
            table.style.display = 'none';
            noData.style.display = 'block';
        }
    }

    // Функция для загрузки общего лидерборда
    async function loadOverallLeaderboard(forceRefresh = false) {
        // Если данные уже загружены и не требуется принудительное обновление, используем кэш
        if (cachedOverallData && !forceRefresh) {
            currentData = cachedOverallData;
            renderOverallLeaderboard(currentData);
            return;
        }
        
        try {
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            
            const response = await fetch(scriptURL + '?action=getLeaderboard');
            const data = await response.json();
            
            // Сохраняем данные в кэш
            cachedOverallData = data;
            currentData = data;
            
            renderOverallLeaderboard(data);
            
            // Заполняем фильтры только при первой загрузке
            if (isInitialLoad) {
                populateFilters(data);
                isInitialLoad = false;
            }
        } catch (error) {
            console.error('Ошибка загрузки данных:', error);
            const loading = document.getElementById('loading');
            loading.innerHTML = '<p>Ошибка загрузки данных</p>';
            currentData = [];
        }
    }

    // Функция для загрузки лидерборда по категории
    async function loadCategoryLeaderboard(category) {
        try {
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            
            const response = await fetch(scriptURL + '?action=getCategoryLeaderboard&category=' + encodeURIComponent(category));
            const data = await response.json();
            
            const table = document.getElementById('leaderboardTable');
            const tbody = document.getElementById('leaderboardBody');
            const tableHeader = document.getElementById('tableHeader');
            const noData = document.getElementById('noData');
            
            if (data && data.length > 0) {
                // Устанавливаем заголовки для категории
                tableHeader.innerHTML = `
                    <th class="rank">Место</th>
                    <th>Участник</th>
                    <th>Должность</th>
                    <th>Город</th>
                    <th>Сеть</th>
                    <th>Время</th>
                    <th>Дата</th>
                `;
                
                // Заполняем таблицу
                tbody.innerHTML = '';
                data.forEach((participant, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="rank rank-${index + 1}">${index + 1}</td>
                        <td class="participant-name">${participant.participant}</td>
                        <td>${participant.participantRole}</td>
                        <td>${participant.city}</td>
                        <td>${participant.network}</td>
                        <td>${participant.time}</td>
                        <td>${participant.date}</td>
                    `;
                    tbody.appendChild(row);
                });
                
                loading.style.display = 'none';
                table.style.display = 'table';
                noData.style.display = 'none';
            } else {
                loading.style.display = 'none';
                table.style.display = 'none';
                noData.style.display = 'block';
            }
        } catch (error) {
            console.error('Ошибка загрузки данных:', error);
            document.getElementById('loading').innerHTML = '<p>Ошибка загрузки данных</p>';
        }
    }

    // Функция для заполнения фильтров (вызывается только один раз)
    function populateFilters(data) {
        const networks = [...new Set(data.map(p => p.network))].filter(n => n);
        const cities = [...new Set(data.map(p => p.city))].filter(c => c);
        
        const networkFilter = document.getElementById('networkFilter');
        const cityFilter = document.getElementById('cityFilter');
        
        // Очищаем только если фильтры уже заполнены
        if (networkFilter.children.length > 1) {
            // Сохраняем первый элемент (опцию "Все сети")
            const firstNetworkOption = networkFilter.children[0];
            networkFilter.innerHTML = '';
            networkFilter.appendChild(firstNetworkOption);
            
            // Сохраняем первый элемент (опцию "Все города")
            const firstCityOption = cityFilter.children[0];
            cityFilter.innerHTML = '';
            cityFilter.appendChild(firstCityOption);
        }
        
        // Добавляем уникальные сети
        networks.forEach(network => {
            const option = document.createElement('option');
            option.value = network;
            option.textContent = network;
            networkFilter.appendChild(option);
        });
        
        // Добавляем уникальные города
        cities.forEach(city => {
            const option = document.createElement('option');
            option.value = city;
            option.textContent = city;
            cityFilter.appendChild(option);
        });
        
        // Добавляем обработчики событий для фильтров
        networkFilter.addEventListener('change', filterLeaderboard);
        cityFilter.addEventListener('change', filterLeaderboard);
    }

    // Функция для фильтрации таблицы
    function filterLeaderboard() {
        if (currentLeaderboardType !== 'overall' || !currentData || currentData.length === 0) return;
        
        const networkFilter = document.getElementById('networkFilter').value;
        const cityFilter = document.getElementById('cityFilter').value;
        const tbody = document.getElementById('leaderboardBody');
        
        // Очищаем таблицу
        tbody.innerHTML = '';
        
        // Фильтруем данные
        const filteredData = currentData.filter(participant => {
            const networkMatch = !networkFilter || participant.network === networkFilter;
            const cityMatch = !cityFilter || participant.city === cityFilter;
            return networkMatch && cityMatch;
        });
        
        // Заполняем таблицу отфильтрованными данными
        filteredData.forEach((participant, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="rank rank-${index + 1}">${index + 1}</td>
                <td class="participant-name">${participant.participant}</td>
                <td>${participant.participantRole}</td>
                <td>${participant.city}</td>
                <td>${participant.network}</td>
                <td>${participant.totalTime}</td>
            `;
            tbody.appendChild(row);
        });
        
        // Показываем сообщение, если нет данных после фильтрации
        const table = document.getElementById('leaderboardTable');
        const noData = document.getElementById('noData');
        
        if (filteredData.length === 0) {
            table.style.display = 'none';
            noData.style.display = 'block';
        } else {
            table.style.display = 'table';
            noData.style.display = 'none';
        }
    }

    // Функция для переключения типа лидерборда
    function switchLeaderboardType(type) {
        currentLeaderboardType = type;
        
        const overallBtn = document.querySelector('[data-type="overall"]');
        const categoryBtn = document.querySelector('[data-type="category"]');
        const filters = document.querySelector('.filters');
        const categorySelector = document.getElementById('categorySelector');
        
        // Сбрасываем состояние
        overallBtn.classList.remove('active');
        categoryBtn.classList.remove('active');
        
        if (type === 'overall') {
            overallBtn.classList.add('active');
            filters.style.display = 'flex';
            categorySelector.style.display = 'none';
            
            // Сбрасываем фильтры при переключении на общий зачет
            document.getElementById('networkFilter').value = '';
            document.getElementById('cityFilter').value = '';
            
            // Используем кэшированные данные вместо повторной загрузки
            loadOverallLeaderboard(false); // false = не принуждать к обновлению
        } else {
            categoryBtn.classList.add('active');
            filters.style.display = 'none';
            categorySelector.style.display = 'flex';
            
            // Сбрасываем таблицу при переключении на категории
            const table = document.getElementById('leaderboardTable');
            const tbody = document.getElementById('leaderboardBody');
            const noData = document.getElementById('noData');
            const loading = document.getElementById('loading');
            
            table.style.display = 'none';
            tbody.innerHTML = '';
            noData.style.display = 'none';
            loading.style.display = 'none';
            
            // Сбрасываем выбор категории
            document.getElementById('categoryFilter').value = '';
        }
    }

    // Функция для принудительного обновления данных
    function refreshLeaderboard() {
        if (currentLeaderboardType === 'overall') {
            loadOverallLeaderboard(true); // true = принудительное обновление
        } else {
            const category = document.getElementById('categoryFilter').value;
            if (category) {
                loadCategoryLeaderboard(category);
            }
        }
    }

    // Инициализация при загрузке страницы
    document.addEventListener('DOMContentLoaded', function() {
        // Загружаем общий лидерборд по умолчанию
        loadOverallLeaderboard();
        
        // Обработчики для переключения типа лидерборда
        document.querySelectorAll('.type-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const type = this.getAttribute('data-type');
                switchLeaderboardType(type);
            });
        });
        
        // Обработчик для выбора категории
        document.getElementById('categoryFilter').addEventListener('change', function() {
            const category = this.value;
            if (category) {
                loadCategoryLeaderboard(category);
            }
        });

        // Добавляем кнопку обновления в интерфейс
        addRefreshButton();
    });

    // Функция для добавления кнопки обновления
    function addRefreshButton() {
        const header = document.querySelector('header');
        const refreshBtn = document.createElement('button');
        refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Обновить';
        refreshBtn.className = 'refresh-btn';
        refreshBtn.style.cssText = `
            background: linear-gradient(45deg, #4CAF50 0%, #45a049 100%);
            border: none;
            padding: 8px 15px;
            border-radius: 25px;
            font-size: 0.9rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            margin-top: 10px;
        `;
        
        refreshBtn.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.3)';
        });
        
        refreshBtn.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';
        });
        
        refreshBtn.addEventListener('click', refreshLeaderboard);
        
        header.appendChild(refreshBtn);

        // Адаптивность для мобильных
        const mediaQuery = window.matchMedia('(max-width: 768px)');
        function handleMobileChange(e) {
            if (e.matches) {
                refreshBtn.style.padding = '6px 12px';
                refreshBtn.style.fontSize = '0.85rem';
            } else {
                refreshBtn.style.padding = '8px 15px';
                refreshBtn.style.fontSize = '0.9rem';
            }
        }
        mediaQuery.addListener(handleMobileChange);
        handleMobileChange(mediaQuery);
    }
</script>
</body>
</html>
